## 加解密字段洗数

针对业务库表已存在数据的情况下，进行对明文列字段进行处理

 0、配置都统一从配置中心中获取（schema、加密规则、数据源）
 
 1、加密表增加密文列字段
 
 2、基于加密算法结合配置中心的字段加密规则（eg: AES及其aes-key-value）进行“洗数”
 
 涉及问题：
 
 1、断点续传，洗数中断后能续点洗数
 
 2、设计方案讨论
 
 方案一、直接对业务表（加密表）进行操作（新增字段、基于明文列和加密算法生成密文，然后更新到密文列） 
 
 优点：简单，直接
 
 缺点：性能比较差，做断点续传比较麻烦；需要计划夜间调度洗数
 
 方案二、对加密表进行ETL抽数（只抽取主键+明文列数据），通过ETL工具进行明文列数据加密，拓展加密列数据，验证加解密结果正确，更新会源表
 
 优点：能断点续传，可以实时抽取数据库变化数据，进行更新
 
 缺点：链路比较长，需要与数仓平台申请Flink环境，相对复杂
 
 方案三、参考第三方公司，用数据库存储过程处理
 
 优点：能借鉴
 
 缺点：厂商的中间件版本是4.x，代码逻辑差异大；不熟悉存储过程
 
 方案四、分批查询源表（查询主键+明文列数据），对每条数据基于代理连接，进行更新SQL
 （update  t_user_info_encrypt_v1 set account='adf12312' where id =2;代理会自动转为密文列SQL
 update  t_user_info_encrypt_v1 set account_cipher = 'VWUntt1yNRGJ0nR8Y8eAeg==' where id =2）
 
 
> 洗数：明文列值+加密算法=密文列值
 
 