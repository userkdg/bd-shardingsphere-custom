package cn.com.bluemoon.shardingsphere.custom.cli;

import cn.com.bluemoon.shardingsphere.custom.spark.shuffle.EncryptShuffleCli;
import cn.com.bluemoon.shardingsphere.custom.spark.shuffle.base.ShuffleMode;
import cn.com.bluemoon.shardingsphere.custom.spark.shuffle.encrypt.EncryptGlobalConfig;
import cn.com.bluemoon.shardingsphere.custom.spark.shuffle.encrypt.EncryptGlobalConfigSwapper;
import com.google.gson.Gson;
import org.apache.spark.SparkConf;
import org.apache.spark.sql.Dataset;
import org.apache.spark.sql.Row;
import org.apache.spark.sql.SparkSession;
import org.junit.Test;

import java.util.Collections;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

/**
 * @author Jarod.Kong
 */
public class EncryptShuffleCliAllTest {
    private String[] args;
    private Map<String, Object> tableKeys;

    @Test
    public void test() throws Exception {
        String tableKey = "{\"ec_oms_job_task_info\":[\"job_id\"],\"oms_b2b_finance_client_daily_balance\":[\"id\"],\"ec_oms_plat_doudian_push_message\":[\"id\"],\"ec_oms_product_review_tmall\":[\"oid\",\"created\"],\"ec_oms_sms_manual_config\":[\"id\"],\"ec_oms_update_plat_delivery_fail_log\":[\"order_code\",\"callback_type\"],\"ec_oms_notice_push_time\":[\"id\"],\"ec_oms_hot_consul_day_shop_acc_leader\":[\"id\"],\"ec_oms_order_oper_log\":[\"id\"],\"ec_oms_plat_refund_record\":[\"shop_order_id\",\"shop_code\",\"shop_refund_id\"],\"ec_oms_chat_user_suning\":[\"chat_id\"],\"ec_oms_exc_reissue_order\":[\"reissue_code\"],\"ec_oms_exc_reissue_order_sub\":[\"id\"],\"dim_area\":[],\"oms_b2b_base_level_magnitude\":[\"id\"],\"ec_oms_jd_product_info\":[\"id\"],\"ec_oms_config_order_catch_delay\":[\"id\"],\"ec_oms_config_shop_supply\":[\"id\"],\"ec_oms_amount_refund_apply\":[\"apply_code\"],\"ec_oms_exc_return_goods\":[\"return_goods_code\"],\"oms_b2b_base_strategy_price\":[\"id\"],\"ec_oms_exc_tmall_order_self_intercept_summary\":[\"tid\"],\"ec_oms_delivery_limitation_strategy_buyer_sub\":[\"id\"],\"oms_b2b_finance_debited_quota_fail_log\":[\"id\"],\"oms_b2b_base_product_level_price_import\":[\"id\"],\"ec_oms_order_delivery_register_info_sub\":[\"id\"],\"ec_oms_product_evaluation_jd\":[\"comment_id\"],\"ec_oms_exc_order\":[\"id\"],\"oms_b2b_level_price_update_product\":[\"id\"],\"ec_oms_update_plat_delievery_params\":[\"id\"],\"oms_b2b_unit_order_sap\":[\"id\"],\"ec_oms_old_order_relation\":[\"order_code\"],\"ec_oms_order_discount_jd\":[\"discount_id\"],\"ec_oms_order_waybill_relation_tmp\":[\"id\"],\"ec_oms_product_evaluation_jd_images\":[\"id\"],\"ec_oms_risk_shop_prd_plan\":[\"plan_code\"],\"test_level_price_update\":[\"id\"],\"ec_oms_temporary_receipt_order_sub\":[\"id\"],\"external_sys_user\":[\"id\"],\"ec_oms_exc_refund_order\":[\"refund_code\"],\"mall_sys_menu_temp\":[\"menu_id\"],\"ec_oms_schedule\":[\"id\"],\"dim_ec_oms_channel_shop_info_test\":[],\"ec_oms_delivery_limitation_strategy_shop_sub\":[\"id\"],\"oms_b2b_finance_clinent_quota_monitor_sender\":[\"email\"],\"ec_oms_order_original_product_detail_tmp\":[\"id\"],\"ec_oms_exc_offline_refund_order\":[\"offline_refund_code\"],\"oms_b2b_receipt_info\":[\"id\"],\"ec_oms_retention_product_inventory_warning_push_user\":[\"id\"],\"external_sys_role_data\":[\"role_id\",\"client_code\"],\"ec_oms_config_assign_express_sub\":[\"id\"],\"ec_oms_exc_refund_pdd\":[\"refund_code\"],\"ec_oms_config_assign_express\":[\"id\"],\"ec_oms_retention_product_strategy_storehouse_sub\":[\"id\"],\"ec_oms_hot_consul_email_template_send\":[\"id\"],\"ec_oms_plat_change_plan\":[\"shop_code\"],\"ec_oms_notice\":[\"id\"],\"ec_oms_invoice_express_apply_record\":[\"id\"],\"ec_oms_customer_service_group\":[\"group_code\"],\"oms_b2b_announcement_client\":[\"id\"],\"oms_b2b_oper_strategy_present_limit\":[\"strategy_code\"],\"ec_oms_order_tmall\":[\"tid\"],\"ec_oms_sms_template\":[\"template_code\"],\"ec_oms_plat_api_measure\":[\"id\"],\"oms_b2b_base_strategy_level_price\":[\"id\"],\"ec_oms_risk_email_template_remind_config\":[\"id\"],\"ec_oms_plat_suning_receipt_order\":[\"received_code\"],\"ec_oms_plat_token_info\":[\"id\"],\"sys_action_log\":[\"id\"],\"ec_oms_order_aikucun_product_detail\":[],\"sys_auth_user_role\":[\"user_id\",\"role_id\"],\"tb_sequence_tmp\":[\"id\"],\"ec_oms_hot_consul_account_group_leader\":[\"id\"],\"ec_oms_tmall_product_props_dict\":[\"id\"],\"ec_oms_prd_convert_plan_sub\":[\"id\"],\"ec_oms_catch_delay_strategy_detail\":[\"id\"],\"ec_oms_product_review_jd\":[\"review_id\"],\"oms_b2b_receipt\":[\"id\"],\"ec_oms_product_review_jd_reply\":[\"replyid\"],\"ec_oms_order_original_product_detail\":[\"id\"],\"ec_oms_notice_object\":[\"id\"],\"sys_auth_user_info\":[\"user_id\"],\"oms_b2b_delivery_register_info\":[\"id\"],\"oms_b2b_base_product_info\":[\"base_id\"],\"ec_oms_plat_product_detail\":[\"plat_product_id\"],\"dim_ec_channel_data_authorization\":[],\"ec_oms_exc_refund_sa_config\":[\"id\"],\"oms_b2b_client_inventory\":[\"id\"],\"ec_oms_product_base_20210208\":[\"product_code\"],\"oms_b2b_client_apply\":[\"application_code\"],\"ec_oms_ag_recover_send_config_op_record\":[\"id\"],\"ec_oms_delivery_limitation_strategy_delivery_sub\":[\"id\"],\"ec_oms_amount_refund_apply_log\":[\"id\"],\"oms_b2b_oper_client_platform\":[\"id\"],\"ec_oms_order_delivery_register_info\":[\"id\"],\"ec_oms_auto_assignment\":[\"plan_code\"],\"ec_oms_get_plat_job_param\":[\"job_param_id\"],\"oms_b2b_temporary_receipt_sub\":[\"id\"],\"ec_oms_plat_change_plan_pre\":[\"shop_code\"],\"ec_oms_plat_authorization_config\":[\"shop_code\"],\"ec_oms_catch_delay_strategy\":[\"id\"],\"ec_oms_order_product_detail_tmp\":[\"id\"],\"oms_b2b_plat_ec_product_relation\":[\"distri_channel_code\",\"plat_product_code\"],\"external_ext_work_order\":[\"work_order_code\"],\"ec_oms_schedule_sub\":[\"id\"],\"ec_oms_order_weixin_product_detail_record\":[\"order_id\",\"outer_sku_id\"],\"ec_oms_exc_refund_sa\":[\"refund_code\"],\"ec_oms_product_price_structure_base\":[\"price_id\"],\"oms_b2b_client_inventory_log\":[\"id\"],\"ec_oms_risk_send_person\":[\"id\"],\"ec_oms_plat_order_record_tmall_presale\":[\"tid\"],\"ec_oms_plat_express_company_code\":[\"id\"],\"oms_b2b_base_product_info_import\":[\"base_id\"],\"ec_oms_product_base_distri_shop\":[\"id\"],\"ec_oms_channel_shop_close_config\":[\"id\"],\"ec_oms_finance_order_push_record\":[\"id\"],\"ec_oms_retention_product_strategy\":[\"id\"],\"ec_oms_hot_consul_email_template_shop\":[\"id\"],\"dim_ec_channel_data_authorization_test\":[],\"oms_b2b_temporary_receipt_base\":[\"receipt_code\"],\"ec_oms_plat_suning_receipt_detail_order\":[\"received_code\",\"received_item\"],\"ec_oms_product_price_strategy_detail\":[\"id\"],\"oms_b2b_finance_clinent_quota_monitor_receiver\":[\"client_code\",\"email\"],\"ec_oms_pdd_refund_config\":[\"id\"],\"ec_oms_product_review_jd_images\":[\"id\"],\"sys_role_menu\":[\"role_id\",\"menu_id\"],\"ec_oms_product_base\":[\"product_code\"],\"ec_oms_exc_refund_ag_config\":[\"id\"],\"oms_b2b_finance_settlement_info\":[\"settlement_code\"],\"ec_oms_order_discount\":[\"id\"],\"ec_oms_product_price_strategy\":[\"strategy_code\"],\"ec_oms_customer_service\":[\"id\"],\"mall_sys_menu_btn_temp\":[\"id\"],\"ec_oms_order_product_recovery\":[\"id\"],\"ec_oms_notice_user\":[\"id\"],\"sys_user\":[\"id\"],\"ec_oms_auto_assignment_sub\":[\"id\"],\"oms_b2b_finance_clinent_quota_monitor_balance\":[\"client_code\"],\"ec_oms_exc_refund_order_sub\":[\"id\"],\"ec_oms_order_2b_expand\":[\"order_code\"],\"ec_oms_chat_content_suning\":[\"msg_id\"],\"ec_oms_address_modify_record\":[\"id\"],\"ec_oms_invoice_wait_flush\":[\"id\"],\"ec_oms_order_risk_batch\":[\"risk_batch\"],\"ec_oms_order_send_delivery_wechat_subscription_log\":[\"id\"],\"ec_oms_plat_pddgongxiao_code_mapping\":[\"shop_order_id\"],\"ec_oms_order_tmall_gongxiao\":[\"fenxiao_id\"],\"ec_oms_exc_return_goods_sub\":[\"id\"],\"dim_ec_oms_channel_shop_info\":[],\"ec_oms_ag_recover_send_config_sub\":[\"id\"],\"oms_b2b_client_inventory_info\":[\"id\"],\"ec_oms_issue_type_reason_relation\":[\"id\"],\"ec_oms_order_product_detail\":[\"id\"],\"ec_oms_product_base_temp\":[\"product_code\"],\"ec_oms_order_presale_strategy_product_sub\":[\"id\"],\"ec_oms_generate_plat_order_exception\":[\"id\"],\"oms_b2b_client_apply_settlement\":[\"id\"],\"oms_b2b_order_use_strategy_price\":[\"id\"],\"ec_oms_order_strategy_scapling\":[\"strategy_code\"],\"oms_b2b_finance_recharge_sub\":[\"id\"],\"ec_oms_retention_product_strategy_record\":[\"id\"],\"ec_oms_prd_convert_plan\":[\"plan_code\"],\"ec_oms_hot_consul_day_shop_acc\":[\"id\"],\"ec_oms_hot_consul_account\":[\"account_code\"],\"ec_oms_edit_order_product_import\":[\"id\"],\"dim_ec_oms_product_base_test\":[],\"ec_oms_plat_order_record_original\":[\"shop_order_id\",\"shop_code\"],\"ec_oms_edit_order_import\":[\"id\"],\"ec_oms_config_shop_supply_sub\":[\"id\"],\"ec_oms_retention_product_strategy_buyer_sub\":[\"id\"],\"ec_oms_product_base_shop\":[\"id\"],\"ec_oms_order_presale_strategy\":[\"id\"],\"ec_oms_config_order_hang\":[\"hand_code\"],\"mall_unit_tmall_tmc_message\":[\"id\"],\"ec_oms_retention_product_inventory_warning\":[\"id\"],\"ec_oms_tmall_product_base\":[\"num_iid\"],\"ec_oms_plat_yunji_mobile_record\":[\"order_id\"],\"ec_oms_order_waybill_relation\":[\"id\"],\"ec_oms_order_risk_control\":[\"id\"],\"ec_oms_plat_tmall_invoice_apply_log\":[\"id\"],\"oms_b2b_base_level_info\":[\"id\"],\"ec_oms_product_evaluation_jd_replies\":[\"id\"],\"dim_ec_oms_zz_product_info\":[],\"ec_oms_tmall_product_base_desc_text\":[\"num_iid\"],\"testparam\":[\"id\"],\"ec_oms_hot_consul_qa_mark\":[\"id\"],\"ec_oms_order_tmall_product_detail\":[\"tid\",\"oid\"],\"ec_oms_plat_order_repeat_alarm\":[\"id\"],\"oms_b2b_base_strategy_client\":[\"id\"],\"oms_b2b_announcement_management\":[\"id\"],\"ec_oms_scapling_product_base\":[\"plan_code\"],\"ec_oms_order_encrypt_test\":[],\"ec_oms_order_guangfa_waybill_status\":[\"serial_no\",\"sub_order_id\"],\"ec_oms_risk_reason_import\":[\"id\"],\"ec_oms_order_waybill_tmp\":[\"id\"],\"ec_oms_order_discount_tmp\":[\"id\"],\"ec_oms_package_issue_base\":[\"package_issue_code\"],\"ec_oms_order_convert_relation\":[\"id\"],\"tmp_testparam\":[\"id\"],\"ec_oms_plat_tuyue_code_mapping\":[\"shop_order_id\"],\"ec_oms_hot_consul_day_shop\":[\"id\"],\"ec_oms_plat_tmall_packages_delivery\":[\"id\"],\"dba_oms_b2b_finance_receipt_settlement_detail\":[\"id\"],\"ec_oms_plat_callback_monitor_config\":[\"shop_code\",\"callback_type\"],\"sys_role\":[\"id\"],\"ec_oms_order_discount_config\":[\"id\"],\"ec_oms_get_plat_job\":[\"job_id\"],\"oms_b2b_oper_client_base\":[\"client_code\"],\"sys_dict_entry\":[\"id\"],\"ec_oms_invoice_waybill\":[\"order_code\",\"waybill_code\"],\"ec_oms_plat_jdgongxiao_code_mapping\":[\"shop_order_id\"],\"external_sys_user_role\":[\"user_id\",\"role_id\"],\"fact_ec_upload_send_time\":[],\"external_sys_menu\":[\"id\"],\"ec_oms_sms_management\":[\"id\"],\"ec_oms_plat_tmall_tmc_message\":[\"id\"],\"oms_b2b_client_stock_log\":[\"id\"],\"ec_oms_scapling_risk_config\":[\"id\"],\"ec_oms_order_pinduoduo_product_details\":[\"id\"],\"ec_oms_tmall_product_sku_base\":[\"sku_id\"],\"ec_oms_self_help_link_detail\":[\"id\"],\"ec_oms_customer_service_group_relation\":[\"id\"],\"dim_ec_ldp_warehouse_test\":[\"pk_warehouse_id\"],\"t1\":[\"id\"],\"ec_oms_plat_receipt_detail\":[\"receipt_detail_id\"],\"ec_oms_plat_purchase_order_detail\":[\"purchase_detail_id\"],\"ec_oms_hot_consul_qa_upload_detail\":[\"id\"],\"oms_b2b_order_use_strategy_present\":[\"id\"],\"oms_b2b_client_agreed_price_update\":[\"update_list_code\"],\"ec_oms_sms_management_sub\":[\"id\"],\"ec_oms_plat_order_encrypt_data\":[\"order_code\"],\"ec_oms_plat_city_code_mapping\":[\"id\"],\"oms_b2b_client_distri_channel_charge\":[\"id\"],\"ec_oms_invoice_apply_record\":[\"id\"],\"ec_oms_retention_product_strategy_storehouse_express_sub\":[\"id\"],\"oms_b2b_client_storehouse\":[\"client_storehouse_code\"],\"oms_b2b_client_agreed_price_update_product\":[\"id\"],\"ec_oms_config_order_examine\":[\"id\"],\"ec_oms_task_log\":[\"id\"],\"oms_b2b_announcement_notification_object\":[\"id\"],\"oms_b2b_level_price_update_product_magnitude\":[\"id\"],\"dba_test02\":[\"id\"],\"ec_oms_plat_tmall_presale_product_detail\":[\"plat_product_id\"],\"ec_oms_plat_huihong_mapping\":[\"id\"],\"oms_b2b_client_declaration\":[\"id\"],\"dba_test01\":[\"id\"],\"mall_express_info_kuaiyun\":[\"id\"],\"ec_oms_self_help_query_log\":[\"id\"],\"ec_oms_config_order_hang_sub\":[\"id\"],\"ec_oms_delivery_limitation_strategy_talent_sub\":[\"id\"],\"ec_oms_hot_consul_email_template\":[\"template_code\"],\"ec_oms_exc_tmall_order_self_intercept_detail\":[],\"ec_oms_order_status\":[\"order_code\"],\"ec_oms_order_oper_log_tmp\":[\"id\"],\"ec_oms_risk_order_import\":[\"id\"],\"fact_upload_ec_hd_send_time_test\":[],\"oms_b2b_client_declaration_info\":[\"id\"],\"ec_oms_channel_shop_base\":[\"shop_code\"],\"ec_oms_address_clean_record\":[\"id\"],\"oms_b2b_finance_amount_stock\":[\"id\"],\"writeoff_ec_order\":[\"id\"],\"sys_interface_log\":[\"id\"],\"ec_oms_classes\":[\"classes_code\"],\"oms_b2b_oper_client_account\":[\"id\"],\"oms_b2b_level_price_update\":[\"update_list_code\"],\"ec_oms_issue_subject_base\":[\"issue_subject_code\"],\"tmp_bill\":[\"id\"],\"ec_oms_order_youzan_product_detail\":[\"tid\",\"outeritemid\",\"itemid\"],\"ec_oms_edit_order_finenter\":[\"id\"],\"ec_oms_chat_content_guomei\":[\"id\"],\"ec_oms_plat_purchase_order\":[\"purchase_id\"],\"ec_oms_risk_email_reminder_time\":[\"id\"],\"oms_b2b_finance_settlement_detail\":[\"id\"],\"ec_oms_vip_sku_stock\":[\"id\"],\"external_sys_role_menu\":[\"role_id\",\"menu_id\"],\"ec_oms_channel_shop_member_detail\":[\"id\"],\"ec_oms_issue_reason_base\":[\"issue_reason_code\"],\"oms_b2b_client_distri_channel\":[\"distri_channel_code\"],\"ec_oms_scapling_order\":[\"order_code\"],\"ec_oms_plat_order_record\":[\"shop_order_id\",\"shop_code\"],\"ec_oms_order_vitual_mobile_import\":[\"id\"],\"ec_oms_order_import\":[\"id\"],\"dim_ec_ldp_express_test\":[\"pk_express_id\"],\"mall_express_info_wuliu\":[\"id\"],\"ec_oms_order_tmall_gongxiao_sub_purchase_order\":[\"fenxiao_id\"],\"ec_oms_delivery_limitation_strategy_record\":[\"id\"],\"ec_oms_product_sub_base\":[\"id\"],\"ec_oms_order_risk_control_tmp\":[\"id\"],\"ec_oms_plat_tuyue_product_detail\":[\"item_id\",\"shop_order_id\"],\"ec_oms_delivery_limitation_strategy\":[\"strategy_code\"],\"ec_oms_master_data_import\":[\"id\"],\"ec_oms_refund_tmall\":[\"refundid\"],\"ec_oms_exc_tmall_order_self_intercept\":[\"self_intercept_id\"],\"ec_oms_sms_account_base\":[\"account_code\"],\"ec_oms_auto_add_present\":[\"plan_code\"],\"ec_oms_hot_consul_qa_upload\":[\"upload_code\"],\"ec_oms_channel_base\":[\"channel_code\"],\"oms_b2b_base_product_level_price\":[\"id\"],\"ec_oms_plat_district_code_mapping\":[\"id\"],\"ec_oms_risk_email_template\":[\"id\"],\"ec_oms_order_bm_expand\":[\"order_code\"],\"ec_oms_exc_refund_ag\":[\"refund_code\"],\"test_crm_gp_demo_food\":[\"id\"],\"ec_oms_notice_push_user\":[\"id\"],\"oms_b2b_client_declaration_log\":[\"id\"],\"ec_oms_temporary_receipt_order\":[\"receipt_code\"],\"ec_oms_order_message_inspection\":[\"order_code\"],\"dba_batch_insert\":[\"id\"],\"ec_oms_config_risk_control\":[\"id\"],\"t_user3\":[\"id\"],\"t_user2\":[\"id\"],\"t_user1\":[\"id\"],\"t_user0\":[\"id\"],\"dim_moonr_oms_channel_shop_info_test\":[],\"t_user_address3\":[\"id\"],\"sys_role_data\":[\"role_id\",\"data_id\",\"data_type\"],\"external_sys_role\":[\"id\"],\"ec_oms_sms_template_plat_register\":[\"id\"],\"ec_oms_auto_add_present_sub\":[\"id\"],\"buried_point_config\":[\"id\"],\"sys_menu\":[],\"ec_oms_get_plat_job_log\":[\"job_log_id\"],\"oms_b2b_base_present_info\":[\"id\"],\"t_user_address0\":[\"id\"],\"ec_oms_order_presale_strategy_detail\":[\"order_code\"],\"t_user_address2\":[\"id\"],\"t_user_address1\":[\"id\"],\"ec_oms_monitor_record\":[\"id\"],\"t_tab1\":[\"id\"],\"oms_b2b_finance_recharge_base\":[\"recharge_code\"],\"oms_b2b_oper_strategy_product_list\":[\"id\"],\"ec_oms_scapling_plan\":[\"plan_code\"],\"ec_oms_order_delivery_guomei\":[\"order_no\"],\"sys_dict_type\":[\"id\"],\"oms_b2b_oper_client_relation\":[\"id\"],\"oms_b2b_base_strategy_info\":[\"strategy_code\"],\"ec_oms_order_presale_strategy_buyer_sub\":[\"id\"],\"ec_oms_self_help_service_order_complement\":[\"id\"],\"ec_oms_get_plat_job_param_log\":[\"log_param_log_id\"],\"mall_area_update_record\":[\"record_id\"],\"ec_oms_exc_work_order\":[\"work_order_code\"],\"ec_oms_self_help_service_order\":[\"id\"],\"ec_oms_plat_order_decrypt_data\":[\"order_code\"],\"sys_user_role\":[\"user_id\",\"role_id\"],\"ec_oms_package_issue_handle_method\":[\"id\"],\"ec_oms_risk_template_reminder_time\":[\"id\"],\"external_ext_order\":[\"order_code\"],\"ec_oms_attachment\":[\"id\"],\"fact_upload_platform_shop_info\":[],\"ec_oms_chat_account_suning\":[\"cust_num\"],\"ec_oms_invoice\":[\"id\"],\"ec_oms_jd_im_pop_chatlog\":[\"id\"],\"ec_oms_order_zhenkunhang_product_detail\":[\"purchase_order_id\",\"zkh_sku\",\"oms_sku\"],\"ec_oms_order_waybill\":[\"id\"],\"oms_b2b_finance_settlement_oper_info\":[\"id\"],\"oms_b2b_client_stock\":[\"id\"],\"mall_sys_role_temp\":[\"role_id\"],\"ec_oms_plat_province_code_mapping\":[\"id\"],\"ec_oms_customer_group_shop_relation\":[\"id\"],\"ec_oms_order\":[\"order_code\"],\"ec_oms_config_import_order_user\":[\"id\"],\"ec_oms_plat_address_modify_record\":[\"shop_order_id\"],\"ec_oms_product_plat_match_base\":[\"match_id\"],\"ec_oms_order_presale_strategy_shop_sub\":[\"id\"],\"ec_oms_issue_type_base\":[\"issue_type_code\"],\"ec_oms_vip_stock_syn_log\":[\"id\"],\"ec_oms_exc_product\":[\"id\"],\"ec_oms_order_present_record\":[\"id\"],\"dim_ec_user_channel_group\":[],\"t_tab\":[\"id\"],\"ec_oms_config_auto_assignment\":[\"id\"],\"ec_oms_plat_api_measure_config\":[\"api_name\"],\"ec_oms_plat_tmall_presale_order\":[\"shop_order_id\",\"shop_code\"],\"dba_check_otter_sync\":[\"id\"],\"ec_oms_risk_shop_prd_plan_sub\":[\"id\"],\"oms_b2b_client_apply_audit\":[\"id\"],\"ec_oms_auto_assignment_record\":[\"id\"],\"oms_b2b_oper_strategy_product_limit\":[\"strategy_code\"],\"ec_oms_order_tmall_gongxiao_sub_purchase_order_tmp\":[\"fenxiao_id\"],\"ec_oms_plat_receipt\":[\"receipt_id\"],\"ec_oms_exc_reply_progress\":[\"id\"],\"ec_oms_config_auto_examine_adopt\":[\"id\"],\"oms_b2b_client_order_delivery\":[\"order_code\"],\"ec_oms_refund_tmall_gongxiao\":[\"sub_order_id\"],\"help_topic\":[\"help_topic_id\"],\"ec_oms_order_service_order_reply_relation\":[\"reply_id\"],\"external_sale_expense_record\":[\"id\"],\"ec_oms_order_convert_relation_tmp\":[\"id\"],\"ec_oms_ag_recover_send_config\":[\"id\"],\"oms_b2b_oper_strategy_present_list\":[\"id\"],\"oms_b2b_finance_receipt_settlement_detail\":[\"id\"],\"ec_oms_package_issue_info\":[\"id\"],\"ec_oms_self_help_link_config\":[\"id\"],\"ec_oms_retention_product_strategy_shop_sub\":[\"id\"],\"oms_b2b_oper_client_setting\":[\"id\"],\"ec_oms_jd_order_split_record\":[\"id\"]}";
        tableKeys = new Gson().fromJson(tableKey, Map.class);

        SparkConf sparkConf = new SparkConf();
        sparkConf.setMaster("local[1]");
        List<Row> rows;
        try (SparkSession spark = SparkSession.builder().config(sparkConf).getOrCreate()) {
            Dataset<Row> csv = spark.read().option("inferSchema", "true")
                    .option("header", "true").csv("D:\\jarodkong\\pri-project\\shardingsphere\\bd-shardingsphere-custom\\bd-shardingsphere-custom-encrypt-shuffle\\bd-shardingsphere-custom-encrypt-shuffle-spark\\系统敏感信息采集表-公共.csv");
            rows = csv.collectAsList();
        }
        Map<String, List<Row>> tableNameRows = rows.stream().collect(Collectors.groupingBy(r -> {
            Object tableName = r.getAs("tableName");
            return tableName + "";
        }));
        List<EncryptGlobalConfig> configs = tableNameRows.entrySet().stream().map(entry -> {
            EncryptGlobalConfig config = new EncryptGlobalConfig();
            config.setSourceUrl("jdbc:mysql://192.168.234.8:4401/ec_order?user=sharding&password=HGbZYrqlpr25");
            config.setTargetUrl("jdbc:mysql://192.168.243.34:23308/ec_order_db?user=root&password=root");
            config.setRuleTableName(entry.getKey());
            List<String> orDefault = (List<String>) tableKeys.getOrDefault(entry.getKey(), Collections.emptyList());
            config.setPrimaryCols(orDefault.stream().map(t -> new EncryptGlobalConfig.FieldInfo(t)).collect(Collectors.toList()));
            config.setOnYarn(false);
            config.setJobName("电商洗数-ec_order-" + entry.getKey());
            List<Row> tableRows = entry.getValue();
            List<EncryptGlobalConfig.FieldInfo> columnNames = tableRows.stream().map(r -> r.getAs("columnName"))
                    .map(r -> new EncryptGlobalConfig.FieldInfo(String.valueOf(r))).collect(Collectors.toList());
            config.setPlainCols(
                    columnNames
            );
            config.setShuffleMode(ShuffleMode.ReShuffle);
            return config;
        }).collect(Collectors.toList());
        configs.stream().map(EncryptGlobalConfigSwapper.gson::toJson)
                .map(s -> new String[]{"-c=" + s})
                .forEach(s -> {
                    EncryptShuffleCli.main(s);
                });
    }

}
